# Elasticsearch의 텍스트 분석(Analysis)과 토큰화(Tokenization)

## 1. Elasticsearch의 기본 개념: 데이터 저장과 검색

Elasticsearch는 **문서 지향적(document-oriented)** 데이터베이스입니다. 각 문서는 **JSON 형식**으로 저장되며, 이러한 문서들은 **인덱스**에 저장됩니다. 이때 **인덱스**는 데이터를 저장하는 공간이자, **검색을 최적화**하는 방식입니다.

* **검색 최적화**는 단순히 데이터를 **빠르게 찾는 것**을 의미합니다. 예를 들어, 여러분이 "apple"이라는 단어를 검색한다고 할 때, **문서들 속에서 'apple'을 찾기** 위해서는 **그 단어가 어디에 있는지 빠르게 알아내야** 합니다.

## 2. 검색 성능을 위한 텍스트 분석과 토큰화

### 검색 성능 문제:
* **문서에 저장된 텍스트**에서 원하는 단어를 빠르게 찾기 위해서는 **텍스트를 미리 구조화**해서 **빠르게 검색**할 수 있는 형태로 저장해야 합니다. 그렇지 않으면 매번 **문서 전체를 순차적으로 검색**해야 해서 속도가 매우 느려집니다.
* 예를 들어, `"The quick brown fox"`라는 문서가 있다고 할 때, 이 문서에서 `"quick"`이라는 단어를 **빠르게** 찾고 싶습니다. 그런데 문서 안에 **공백이나 구두점** 등 여러 요소들이 섞여 있으면, **"quick"**만을 찾아내는 것이 매우 어려워집니다.

### 토큰화 과정:
* **토큰화**는 이러한 문제를 해결하기 위한 방법입니다. 토큰화는 문서의 텍스트를 의미 있는 **단위**인 **토큰(token)**으로 분할하는 과정입니다.
   * 예를 들어, `"The quick brown fox"`라는 문서를 **단어 단위로** 나누면 `["the", "quick", "brown", "fox"]`라는 **토큰**들이 생성됩니다.
   * 이렇게 하면 **문서 내에서 각 단어를 빠르게 찾을 수 있는 형태**로 저장되기 때문에 **검색 성능**이 크게 향상됩니다.

### 소문자화, 불용어 제거:
* 그뿐만 아니라, 토큰화는 **소문자화(lowercasing)**, **불용어 제거(stop words removal)**, **어근화(stemming)** 등과 같은 추가적인 정규화 작업을 통해 **검색의 정확성**과 **효율성**을 더욱 높입니다.
   * 예를 들어, `"Running"`, `"run"` 등을 **어근화**하여 동일한 **단어**로 처리함으로써 사용자가 `"run"`을 검색할 때 `"running"`과 같은 단어도 일치하도록 만들 수 있습니다.
   * 또한 **불용어**(예: "a", "the", "is")는 검색에 별로 도움이 되지 않기 때문에 이를 **제거**하여 효율성을 높입니다.

## 3. 인덱스에서의 텍스트 분석과 토큰화

Elasticsearch는 **인덱스를 만들 때**, **저장된 텍스트**를 **분석하여 토큰화**하고, 이를 **역색인(inverted index)** 형태로 저장합니다. **역색인**은 **단어**가 **어떤 문서에 포함**되어 있는지를 빠르게 찾을 수 있는 구조입니다.

### 역색인(Inverted Index):
* **역색인**은 **단어**와 그 단어가 포함된 **문서들의 목록**을 저장하는 데이터 구조입니다.
   * 예를 들어, **"quick"**이라는 단어가 문서 1과 문서 2에 포함되어 있으면, 역색인에는 다음과 같이 저장됩니다:
   ```
   "quick": [1, 2]
   ```
   * 이렇게 하면 **"quick"**을 검색할 때, **문서 1과 문서 2**를 빠르게 찾을 수 있습니다.

### 예시:
* **문서 1**: `"The quick brown fox"`
* **문서 2**: `"A quick brown dog"`

### 토큰화 후 저장:
* 문서 1은 `["the", "quick", "brown", "fox"]`
* 문서 2는 `["a", "quick", "brown", "dog"]`

### 역색인:
* `"quick": [1, 2]`
* `"brown": [1, 2]`
* `"the": [1]`
* `"fox": [1]`
* `"a": [2]`
* `"dog": [2]`

### 검색:
* 사용자가 **"quick"**을 검색하면, 역색인에서 `["quick": [1, 2]]`를 찾아서 **문서 1**과 **문서 2**를 빠르게 반환할 수 있습니다.
* 사용자가 **"quick brown"**을 검색하면, `"quick"`과 `"brown"` 모두 포함된 문서인 **문서 1**과 **문서 2**를 반환합니다.
